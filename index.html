<!DOCTYPE html>
<html lang="en">
<head>
  <!-- PWA + Android integration -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Amazon Affiliate Link Converter | Kyle Trading</title>

  <!-- Manifest + theme color -->
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#00ff7f">

  <!-- App icons for Android/Chrome -->
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/icons/icon-512.png">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">

  <!-- Basic SEO / Open Graph (optional) -->
  <meta name="description" content="Paste any Amazon link and instantly convert it to an affiliate link that supports Kyle at no extra cost to you.">
  <meta property="og:title" content="Amazon Affiliate Converter">
  <meta property="og:description" content="Instantly turn any Amazon link into a support link for Kyle.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://amazon-affiliate-converter.netlify.app/">
  <meta property="og:image" content="https://amazon-affiliate-converter.netlify.app/icons/icon-512.png">

  <style>
    :root {
      --color-primary: #00ff7f; /* neon green */
      --color-primary-hover: #19c76b;
      --color-bg: #050608; /* near-black background */
      --color-surface: #101218; /* dark surface */
      --color-text: #f5f7fa; /* light text */
      --color-text-secondary: #8b93a5; /* muted gray */
      --color-success: #00ff7f;
      --color-error: #ff4b5c;
      --color-border: #1f2430;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020308 55%, #000000 100%);
      color: var(--color-text);
      margin: 0;
      padding: 0;
      line-height: 1.6;
    }

    .container {
      max-width: 700px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      text-align: center;
      margin-bottom: 40px;
      padding-top: 20px;
    }

    h1 {
      margin: 0 0 10px 0;
      font-size: 32px;
      font-weight: 600;
      color: var(--color-text);
    }

    .tagline {
      color: var(--color-text-secondary);
      font-size: 16px;
      margin: 0;
    }

    .info-box {
      background: linear-gradient(135deg, #070a0f 0%, #10141f 100%);
      border-left: 4px solid var(--color-primary);
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 30px;
      font-size: 14px;
      color: var(--color-text-secondary);
      border: 1px solid #1f2937;
    }

    .info-box strong {
      color: var(--color-text);
      display: block;
      margin-bottom: 8px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      font-weight: 500;
      margin-bottom: 8px;
      font-size: 14px;
    }

    input[type="text"],
    input[type="url"] {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--color-border);
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
      transition: border-color 0.2s;
      background: #050608;
      color: var(--color-text);
    }

    input[type="text"]::placeholder,
    input[type="url"]::placeholder {
      color: #6b7280;
    }

    input[type="text"]:focus,
    input[type="url"]:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px rgba(0, 255, 127, 0.12);
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
    }

    button {
      flex: 1;
      padding: 12px 16px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--color-primary);
      color: #050608;
      box-shadow: 0 0 18px rgba(0, 255, 127, 0.35);
    }

    .btn-primary:hover {
      background: var(--color-primary-hover);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 255, 127, 0.3);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #000000;
      border: 1px solid var(--color-border);
    }

    .btn-secondary:hover {
      background: #e8e8e8;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .result-box {
      background: linear-gradient(135deg, #070a0f 0%, #10141f 100%);
      border: 1px solid #1f2937;
      border-radius: 8px;
      padding: 16px;
      margin-top: 10px;
      display: none;
    }

    .result-box.show {
      display: block;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .result-box.success {
      border-left: 4px solid var(--color-success);
      box-shadow: 0 0 24px rgba(0, 255, 127, 0.25);
    }

    .result-box.error {
      border-left: 4px solid var(--color-error);
    }

    .result-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--color-text-secondary);
      margin-bottom: 8px;
    }

    .result-content {
      background: #020617;
      padding: 12px;
      border-radius: 4px;
      word-break: break-all;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      margin-bottom: 12px;
      color: #00ff7f;
    }

    .result-button-group {
      display: flex;
      gap: 10px;
      margin-top: 12px;
    }

    .result-button-group button {
      flex: 1;
      padding: 10px;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 500;
    }

    .btn-copy {
      background: var(--color-primary);
      color: var(--color-bg);
    }

    .btn-copy:hover {
      background: var(--color-primary-hover);
    }

    .btn-copy.copied {
      background: var(--color-success);
    }

    .btn-open {
      background: #1f2430;
      color: var(--color-primary);
      border: 1px solid var(--color-primary);
    }

    .btn-open:hover {
      background: var(--color-primary);
      color: var(--color-bg);
    }

    .message {
      font-size: 12px;
      margin-top: 8px;
      padding: 8px 12px;
      border-radius: 4px;
      display: none;
    }

    .message.show {
      display: block;
    }

    .message.success {
      background: #d4edda;
      color: #155724;
    }

    .message.error {
      background: #f8d7da;
      color: #721c24;
    }

    .faq {
      margin-top: 50px;
      padding-top: 30px;
      border-top: 2px solid var(--color-border);
    }

    .faq h2 {
      font-size: 20px;
      margin-bottom: 20px;
    }

    .faq-item {
      margin-bottom: 20px;
    }

    .faq-question {
      font-weight: 600;
      color: var(--color-text);
      margin-bottom: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .faq-question::before {
      content: "▶";
      font-size: 12px;
      transition: transform 0.2s;
    }

    .faq-question.open::before {
      transform: rotate(90deg);
    }

    .faq-answer {
      color: var(--color-text-secondary);
      font-size: 14px;
      display: none;
      padding-left: 22px;
    }

    .faq-answer.show {
      display: block;
    }

    footer {
      text-align: center;
      margin-top: 40px;
      padding-bottom: 20px;
      color: var(--color-text-secondary);
      font-size: 12px;
    }

    @media (max-width: 600px) {
      h1 {
        font-size: 24px;
      }
      .button-group {
        flex-direction: column;
      }
      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Amazon Affiliate Converter</h1>
      <p class="tagline">Convert Amazon links to affiliate links instantly</p>
    </header>

    <div class="info-box">
      <strong>How it works:</strong>
      Please paste any Amazon product link below, and I'll instantly convert it to an affiliate link.
      You get the same product at the exact same price while supporting our efforts indirectly!
    </div>

    <div class="form-group">
      <label for="amazonUrl">Paste your Amazon product link:</label>
      <input
        type="url"
        id="amazonUrl"
        placeholder="https://www.amazon.com/dp/B0..."
        autocomplete="off"
      >
    </div>

    <div class="form-group" style="margin-top:8px;">
      <label style="display:flex;align-items:center;gap:8px;font-weight:400;font-size:13px;">
        <input type="checkbox" id="autoOpenToggle" checked>
        <span>Auto-open Amazon as soon as I paste a link</span>
      </label>
      <p style="margin:6px 0 0 0;font-size:12px;color:var(--color-text-secondary);">
        On mobile: copy the Amazon product link, come back here, and paste it.
        I’ll instantly convert it and send you straight to the Amazon page with my support tag attached.
      </p>
    </div>

    <div class="button-group">
      <button class="btn-primary" onclick="convertLink()">Convert Link</button>
      <button class="btn-secondary" onclick="clearForm()">Clear</button>
    </div>

    <div id="resultBox" class="result-box">
      <div class="result-label">Your Affiliate Link</div>
      <div class="result-content" id="resultContent"></div>
      <div class="result-button-group">
        <button class="btn-copy" onclick="copyToClipboard()">Copy Link</button>
        <button class="btn-open" onclick="openAffiliateLink()">Open Link</button>
      </div>
      <div id="copyMessage" class="message"></div>
    </div>
    <div class="faq">
      <h2>FAQ & Power User Tips</h2>

      <div class="faq-item">
        <div class="faq-question" onclick="toggleFaq(this)">
          How do I use this on mobile?
        </div>
        <div class="faq-answer">
          On Android, open Amazon, find a product, tap share, and copy the link. Then switch to this page or your home screen shortcut, paste the link (or it may auto-paste), and I’ll convert and optionally auto-open it.
        </div>
      </div>

      <div class="faq-item">
        <div class="faq-question" onclick="toggleFaq(this)">
          How do I use this on desktop?
        </div>
        <div class="faq-answer">
          You can paste any Amazon URL in the box above. For faster flow, drag the bookmarklet below to your browser’s bookmarks bar, then click it while on any Amazon product page.
        </div>
      </div>

      <div class="faq-item">
        <div class="faq-question" onclick="toggleFaq(this)">
          What’s the bookmarklet?
        </div>
        <div class="faq-answer">
          Drag this link to your bookmarks bar: 
         <a 
  href="javascript:(function(){window.location.href='https://amazon-converter.netlify.app/?url='+encodeURIComponent(window.location.href);})();" 
  style="color:#60a5fa;text-decoration:underline;"
>
  Amazon Affiliate Converter
</a>
          Then, when you are on an Amazon product page, click the bookmark. It will send the current page URL to this converter automatically.
        </div>
      </div>

      <div class="faq-item">
        <div class="faq-question" onclick="toggleFaq(this)">
          Does this change the price or product?
        </div>
        <div class="faq-answer">
          No. The product and price are identical. The only difference is that Amazon may pay a small commission for qualifying purchases through this link, which helps support my work.
        </div>
      </div>
    </div>

    <footer>
      Built for friends, family, and my network to easily support my work with the same Amazon purchases you already make.
    </footer>
  </div>

  <script>
    const AFFILIATE_TAG = "kyleamazon-20"; // your associate tag

    function showMessage(text, isError = false) {
      const msg = document.getElementById("copyMessage");
      msg.textContent = text;
      msg.className = "message show " + (isError ? "error" : "success");
      setTimeout(() => {
        msg.className = "message";
      }, 2500);
    }

    function extractASIN(url) {
      try {
        const u = new URL(url);
        if (!u.hostname.includes("amazon.")) return null;

        // Handle /dp/ASIN or /gp/product/ASIN patterns
        const dpMatch = u.pathname.match(/\/dp\/([A-Z0-9]{10})/i);
        if (dpMatch) return dpMatch[1];

        const gpMatch = u.pathname.match(/\/gp\/product\/([A-Z0-9]{10})/i);
        if (gpMatch) return gpMatch[1];

        // Fallback: search for a 10-char ASIN-like token
        const asinMatch = u.pathname.match(/\/([A-Z0-9]{10})(?:[\/?]|$)/i);
        if (asinMatch) return asinMatch[1];

        return null;
      } catch (e) {
        return null;
      }
    }

    function buildAffiliateUrl(originalUrl) {
      const asin = extractASIN(originalUrl);
      if (!asin) return null;

      // Preserve region (amazon.com, amazon.ca, etc.)
      const u = new URL(originalUrl);
      const baseHost = u.hostname;

      const affUrl = new URL(`https://${baseHost}/dp/${asin}`);
      affUrl.searchParams.set("tag", AFFILIATE_TAG);
      return affUrl.toString();
    }

    async function resolveIfShortAmazon(url) {
      // If user shares amazon.com/dp/... we’re good.
      // If they share amzn.to/... or other shorteners, we might attempt fetch+follow.
      try {
        const u = new URL(url);
        if (!u.hostname.includes("amzn.to")) {
          return url;
        }

        // Try to resolve via simple fetch (will follow redirects in browser)
        const response = await fetch(u.toString(), { method: "GET", redirect: "follow" });
        if (response.url && response.url !== url) {
          return response.url;
        }
        return url;
      } catch (e) {
        return url;
      }
    }

    async function convertLink(autoFromPaste = false) {
      const input = document.getElementById("amazonUrl");
      const raw = input.value.trim();
      const resultBox = document.getElementById("resultBox");
      const resultContent = document.getElementById("resultContent");
      const autoOpenToggle = document.getElementById("autoOpenToggle");

      if (!raw) {
        showMessage("Please paste an Amazon product link first.", true);
        return;
      }

      resultBox.className = "result-box"; // reset classes
      resultBox.classList.remove("show");

      try {
        const resolved = await resolveIfShortAmazon(raw);
        const affiliateUrl = buildAffiliateUrl(resolved);

        if (!affiliateUrl) {
          resultContent.textContent = "Could not detect a valid Amazon product ASIN from that link.";
          resultBox.classList.add("show", "error");
          showMessage("That link does not look like a valid Amazon product URL.", true);
          return;
        }

        resultContent.textContent = affiliateUrl;
        resultBox.classList.add("show", "success");
        showMessage("Affiliate link created successfully!");

        // Auto-open behavior for Android/mobile
        if (autoFromPaste && autoOpenToggle.checked) {
          // Small delay so the user can see the link flash on screen
          setTimeout(() => {
            openAffiliateLink();
          }, 500);
        }
      } catch (err) {
        console.error(err);
        resultContent.textContent = "There was an error converting your link. Please try again.";
        resultBox.classList.add("show", "error");
        showMessage("Error converting link.", true);
      }
    }

    function openAffiliateLink() {
      const resultContent = document.getElementById("resultContent");
      const url = resultContent.textContent.trim();
      if (!url) {
        showMessage("No affiliate link to open yet.", true);
        return;
      }

      // On Android Chrome/PWA, this will hand off to the Amazon app if installed
      window.location.href = url;
    }

    function copyToClipboard() {
      const resultContent = document.getElementById("resultContent");
      const text = resultContent.textContent.trim();
      if (!text) {
        showMessage("Nothing to copy yet.", true);
        return;
      }

      navigator.clipboard.writeText(text).then(() => {
        const copyBtn = document.querySelector(".btn-copy");
        copyBtn.classList.add("copied");
        copyBtn.textContent = "Copied!";
        showMessage("Affiliate link copied!");

        setTimeout(() => {
          copyBtn.classList.remove("copied");
          copyBtn.textContent = "Copy Link";
        }, 2000);
      }).catch(() => {
        showMessage("Unable to copy. Please copy manually.", true);
      });
    }

    function clearForm() {
      document.getElementById("amazonUrl").value = "";
      const resultBox = document.getElementById("resultBox");
      resultBox.className = "result-box";
      resultBox.classList.remove("show");
      document.getElementById("copyMessage").className = "message";
    }

    function toggleFaq(el) {
      el.classList.toggle("open");
      const answer = el.nextElementSibling;
      answer.classList.toggle("show");
    }

    // Auto-paste + auto-convert when user arrives with ?url=... or with content in clipboard
    async function handleInitialUrlParam() {
      const params = new URLSearchParams(window.location.search);
      const urlParam = params.get("url");
      if (urlParam) {
        const input = document.getElementById("amazonUrl");
        input.value = urlParam;
        await convertLink(true);
      }
    }

    async function tryAutoPasteFromClipboard() {
      if (!navigator.clipboard || !navigator.clipboard.readText) return;
      try {
        const text = (await navigator.clipboard.readText()).trim();
        if (!text) return;
        if (!text.includes("amazon.")) return;

        const input = document.getElementById("amazonUrl");
        // Only auto-fill if the field is empty so we don’t overwrite anything
        if (!input.value.trim()) {
          input.value = text;
          await convertLink(true);
        }
      } catch (e) {
        // Clipboard permission might not be granted; silently ignore
      }
    }

    window.addEventListener("load", async () => {
      await handleInitialUrlParam();
      // Delay clipboard sniff a bit so it feels natural when coming from “Copy link” in Amazon
      setTimeout(tryAutoPasteFromClipboard, 400);
    });
  </script>
</body>
</html>
